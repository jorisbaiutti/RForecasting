---
title: "Documentation"
author: "Joris Baiutti"
date: "June 4, 2018"
output:
  html_document:
    df_print: paged
---



### Load stuff
```{r error=FALSE, warning=FALSE, message=FALSE}
library(Quandl)
library(ggplot2)
```

Api key: 1ywuwWFWbtaziA2GcaRU
```{r}
Quandl.api_key('1ywuwWFWbtaziA2GcaRU')
```

*Data*
https://www.quandl.com/data/EOD-End-of-Day-US-Stock-Prices


## Einleitung
Bei diesem Dokument geht es um die Monte Carlo Simulation von den Aktienkursen von Microsoft, Intel und Apple am Ende des Tages (Closing)
\newpage


## Berechnung der Standardabweichung und des Mittelwertes
Für die Standardabweichung und den Mittelwert werden die prozentualen renditen über den einzelnen Tagen gesammelt. Die Prozentualen renditen lassen sich über das API Quandle ausgeben. Folglich können die Standardabweichung und der Mittelwert daraus berechnet werden.
### Microsoft
#### Die Prozentuale Tagesrenditen
Hier ersichtlich ist die Prozentuale Tagesrenditen über die Zeitperiode
```{r}
microsoftclosing = Quandl("EOD/MSFT",start_date='2017-06-04', type='zoo',end_date='2018-06-04',transform = "rdiff")[,"Close"]
plot(microsoftclosing,ylab="%",xlab="Time",main="Microsoft Stock in [%]")
microsoftsd = sd(microsoftclosing)
microsoftmean = mean(microsoftclosing)
```

#### Mittelwert und die Standard abweichung
```{r}
microsoftmatrix = matrix(c(microsoftsd,microsoftmean),ncol=2,byrow=TRUE)
colnames(microsoftmatrix) = c("Standard deviation","mean")
print.table(microsoftmatrix)
```
```{r }
Microsoft = Quandl('EOD/MSFT', start_date='2017-06-04', end_date='2018-06-04')
ggplot(Microsoft, aes(Date, Close,)) + geom_line() + geom_smooth(method = "lm") + geom_smooth(method = "loess", color="Green") + labs(title="Microsoft closing Stock", y="Price in $", caption="Source: QUOTEMEDIA")
```

#### Brownian Motion
get percentual changes
```{r}
microsoftdata = Quandl('EOD/MSFT', start_date='2017-06-04', end_date='2018-06-04', transform = "rdiff")
```

get only closing stock price
```{r}
microsoftclosing = microsoftdata$Close
```

```{r}
nSim = 1000
nDays = 365
S0 = head(Quandl('EOD/MSFT', start_date='2017-06-04', end_date='2018-06-04'), n=1)
S0 = S0$Close
S = matrix(0,nrow=nDays,ncol=nSim)
```
```{r}
for (i in 1:nSim) {
  SVec = rep(0, nDays)
  SVec[1] = S0
  for(j in 2:nDays) {
    pastDay = SVec[j-1]
    DeltaS = microsoftmean*pastDay + microsoftsd*pastDay*rnorm(1)
    SVec[j] = pastDay+DeltaS
  }
  S[,i] = SVec
}
```

```{r,echo=FALSE}
#Die Berechnung der Simulations grenzen
mean = microsoftmean * nDays
sigma = microsoftsd * sqrt(nDays)
t = seq(from=0,to=1,length.out=nDays)
meanBnd = vector(length = nDays); upBnd = vector(length = nDays); loBnd = vector(length = nDays); test = vector(length = nDays)
for(i in 0:nDays){
  meanBnd[i] = S0*exp((( mean-sigma^2/2 ))*t[i])
  upBnd[i] = S0*exp((( mean-sigma^2/2 ))*t[i] + (sigma * 2.5 * sqrt(t[i])))
  loBnd[i] = S0*exp((( mean-sigma^2/2 ))*t[i] + (sigma * -2.5 * sqrt(t[i])))
}
```


Das Simulation grafisch dargestellt. Die Blauen Linien kennzeichnen die grenzen der Simulationen
```{r,echo=FALSE}
#Darstellung der Graphen
matplot(S,type='l',col=1:100,ylab='Microsoft Stock $',xlab='Days',main='Simulation')
matlines(loBnd,lwd=3,col="blue")
matlines(upBnd,lwd=3,col="blue")
matlines(meanBnd,lwd=3,col="blue")
```

Berechnung der Longnormalen Distribution
```{r}
lnMean = S0*exp(mu*nDays)
lnSD = S0*exp(mu*nDays)*sqrt(exp((sigma^2)*nDays)-1)
```

*Describe*
```{r}
cat(lnMean,mean(S[nDays,]))
```

*Describe*
```{r}
cat(lnSD,sd(S[nDays,]))
```

Plotten der Distribution
```{r}
meanOfLog = log(S0) + (mu-(sigma^2)/2)*nDays
sdOfLog = sigma*sqrt(nDays)
priceGrid = seq(0,lnMean+6*lnSD,length=10000)
theoreticalDens = dlnorm(priceGrid,meanOfLog,sdOfLog)
empiricalDens = density(S[nDays,])

plot(priceGrid,theoreticalDens,type='l',xlab='Prices',ylab='Density')
lines(empiricalDens,col='blue')
```



'EOD/AAPL'
'EOD/INTC'














